<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Miva AI QuickNotes</title>
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      line-height: 1.6;
      background-color: #f8f9fa;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 0.5rem;
    }
    .subtitle {
      text-align: center;
      color: #7f8c8d;
      margin-bottom: 2rem;
    }
    textarea {
      width: 100%;
      height: 200px;
      padding: 1rem;
      border: 2px solid #ecf0f1;
      border-radius: 8px;
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
    }
    textarea:focus {
      outline: none;
      border-color: #3498db;
    }
    button {
      background: #3498db;
      color: white;
      padding: 12px 24px;
      margin-top: 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
    }
    button:hover {
      background: #2980b9;
    }
    button:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
    }
    .output-section {
      margin-top: 2rem;
    }
    .output {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 8px;
      border-left: 4px solid #3498db;
    }
    .summary {
      background: #e8f5e8;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      border-left: 4px solid #27ae60;
    }
    .key-points {
      background: #fff3cd;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      border-left: 4px solid #f39c12;
    }
    .quiz {
      background: #e3f2fd;
      padding: 1rem;
      border-radius: 6px;
      border-left: 4px solid #2196f3;
    }
    ul {
      margin: 0.5rem 0;
      padding-left: 1.5rem;
    }
    .loading {
      text-align: center;
      color: #7f8c8d;
      font-style: italic;
    }
    .error {
      background: #ffebee;
      color: #c62828;
      padding: 1rem;
      border-radius: 6px;
      border-left: 4px solid #f44336;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéì Miva AI QuickNotes</h1>
    <p class="subtitle">AI Study Companion for Online Lectures & PDFs</p>
    <p>Paste your lecture transcript or PDF text below and get a quick summary with key points and quiz questions.</p>
    
    <textarea id="inputText" placeholder="Paste lecture transcript or PDF extracted text here...

Example: 'In today's lecture on photosynthesis, we learned that plants convert sunlight into energy through a complex chemical process. The chloroplasts contain chlorophyll which captures light energy...'"></textarea>
    
    <div style="margin: 15px 0; display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
      <label for="providerSelect" style="font-weight: 500;">AI Provider:</label>
      <select id="providerSelect" style="padding: 8px 12px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px;">
        <option value="">Use Default</option>
        <option value="openai">OpenAI (GPT)</option>
        <option value="gemini">Google Gemini</option>
        <option value="anthropic">Anthropic Claude</option>
        <option value="openrouter">OpenRouter</option>
      </select>
      <button id="refreshProviders" style="background: #95a5a6; padding: 8px 12px; border: none; border-radius: 4px; color: white; cursor: pointer; font-size: 12px;">üîÑ Check Available</button>
    </div>
    
    <div id="providerStatus" style="margin-bottom: 15px;"></div>
    
    <button id="runBtn">üìù Generate Study Notes</button>

    <div class="output-section">
      <h3>üìã Study Notes</h3>
      <div id="output"></div>
    </div>
  </div>

  <script>
    let availableProviders = [];
    
    // Check available providers on page load
    async function checkProviders() {
      try {
        const res = await fetch("http://localhost:8000/providers");
        const data = await res.json();
        availableProviders = Object.keys(data.available_providers);
        
        // Update status
        const status = document.getElementById("providerStatus");
        status.innerHTML = `
          <div style="background: #e8f5e8; padding: 10px; border-radius: 6px; font-size: 14px;">
            <strong>‚úÖ Available Providers:</strong> ${availableProviders.join(", ")} 
            <span style="color: #7f8c8d;">(Default: ${data.default_provider})</span>
          </div>
        `;
        
        // Update dropdown options
        const select = document.getElementById("providerSelect");
        const currentValue = select.value;
        
        // Clear existing options except "Use Default"
        select.innerHTML = '<option value="">Use Default</option>';
        
        // Add available providers
        Object.entries(data.available_providers).forEach(([provider, info]) => {
          const option = document.createElement("option");
          option.value = provider;
          option.textContent = `${provider.charAt(0).toUpperCase() + provider.slice(1)} (${info.model})`;
          select.appendChild(option);
        });
        
        // Restore previous selection if still available
        if (currentValue && availableProviders.includes(currentValue)) {
          select.value = currentValue;
        }
        
      } catch (e) {
        document.getElementById("providerStatus").innerHTML = `
          <div style="background: #ffebee; padding: 10px; border-radius: 6px; color: #c62828; font-size: 14px;">
            ‚ö†Ô∏è Cannot connect to backend. Make sure the server is running.
          </div>
        `;
      }
    }
    
    // Check providers when page loads
    checkProviders();
    
    document.getElementById("refreshProviders").onclick = checkProviders;

    document.getElementById("runBtn").onclick = async () => {
      const text = document.getElementById("inputText").value;
      if (!text.trim()) return alert("Please paste some text first!");
      
      const button = document.getElementById("runBtn");
      const output = document.getElementById("output");
      const provider = document.getElementById("providerSelect").value;
      
      // Show loading state
      button.disabled = true;
      button.textContent = "‚è≥ Generating...";
      output.innerHTML = '<div class="loading">AI is analyzing your text and creating study notes...</div>';
      
      try {
        const requestBody = { text };
        if (provider) {
          requestBody.provider = provider;
        }
        
        const res = await fetch("http://localhost:8000/summarize", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(requestBody)
        });
        
        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.detail || `HTTP ${res.status}: ${res.statusText}`);
        }
        
        const data = await res.json();
        
        // Format the output nicely
        let html = '';
        
        // Add provider info
        if (data._metadata) {
          html += `
            <div style="background: #f0f8ff; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 12px; color: #2c3e50;">
              <strong>ü§ñ Generated by:</strong> ${data._metadata.provider} (${data._metadata.model})
            </div>
          `;
        }
        
        if (data.summary) {
          html += `<div class="summary"><h4>üìù Summary</h4><p>${data.summary}</p></div>`;
        }
        
        if (data.key_points) {
          html += `<div class="key-points"><h4>üîë Key Points</h4><ul>`;
          if (Array.isArray(data.key_points)) {
            data.key_points.forEach(point => {
              html += `<li>${point}</li>`;
            });
          } else {
            html += `<li>${data.key_points}</li>`;
          }
          html += `</ul></div>`;
        }
        
        if (data.quiz_questions) {
          html += `<div class="quiz"><h4>‚ùì Quiz Questions</h4><ul>`;
          if (Array.isArray(data.quiz_questions)) {
            data.quiz_questions.forEach(question => {
              html += `<li>${question}</li>`;
            });
          } else {
            html += `<li>${data.quiz_questions}</li>`;
          }
          html += `</ul></div>`;
        }
        
        if (data.raw) {
          html += `<div class="output"><h4>üìÑ Raw Output</h4><pre>${data.raw}</pre></div>`;
        }
        
        if (!html) {
          html = '<div class="error">No structured output received. Please try again.</div>';
        }
        
        output.innerHTML = html;
        
      } catch (e) {
        output.innerHTML = `<div class="error"><strong>Error:</strong> ${e.message}<br><br><small>Make sure the backend is running on http://localhost:8000</small></div>`;
      } finally {
        // Reset button
        button.disabled = false;
        button.textContent = "üìù Generate Study Notes";
      }
    };
  </script>
</body>
</html>